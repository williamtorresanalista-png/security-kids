<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Kids</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<div id="loading" class="d-flex justify-content-center align-items-center vh-100">
    <div class="text-center">
        <div class="spinner-border text-primary mb-3"></div>
        <p>Carregando...</p>
    </div>
</div>

<div id="app" style="display:none;"></div>

<script>
const API_URL = "https://script.google.com/macros/s/SEU_ENDPOINT_AQUI/exec";

async function carregarDados() {
    const params = new URLSearchParams(window.location.search);
    const codigo = params.get("codigo");

    if (!codigo) {
        mostrarCadastro();
        return;
    }

    try {
        const response = await fetch(`${API_URL}?codigo=${codigo}`);

        let texto = await response.text();
        let data;

        try {
            data = JSON.parse(texto);
        } catch {
            // Se não for JSON, tratamos como código inválido
            mostrarCadastro();
            return;
        }

        if (!data || data.error || !data["Nome da criança"]) {
            mostrarCadastro();
            return;
        }

        renderizarDados(data);

    } catch (e) {
        mostrarErro("Erro ao conectar com o servidor.");
    }
}

function renderizarDados(data) {
    document.getElementById("app").innerHTML = `
        <div class="container text-center mt-4">
            <h2>${data["Nome da criança"]}</h2>
            <p>Cadastro encontrado com sucesso.</p>
        </div>
    `;
    document.getElementById("loading").style.display = "none";
}

function mostrarCadastro() {
    document.getElementById("loading").innerHTML = `
        <div class="text-center p-4">
            <h4 class="text-danger">Pulseira não cadastrada</h4>
            <p>Este código ainda não possui informações.</p>
            <a href="https://tally.so/r/pbd5zy" class="btn btn-primary mt-2">
                Cadastrar agora
            </a>
        </div>
    `;
}

function mostrarErro(msg) {
    document.getElementById("loading").innerHTML = `
        <div class="text-center text-danger">
            <h4>${msg}</h4>
        </div>
    `;
}

carregarDados();
</script>

</body>
</html>
