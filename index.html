<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Security Kids</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<div id="app" class="container text-center mt-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-3">Carregando...</p>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/SEU_ENDPOINT_AQUI/exec";

async function carregar() {
    const params = new URLSearchParams(window.location.search);
    const codigo = params.get("codigo");

    if (!codigo) {
        mostrarCadastro();
        return;
    }

    try {
        const res = await fetch(`${API_URL}?codigo=${codigo}`);
        const data = await res.json();

        if (data.status === "OK") {
            mostrarDados(data.dados);
            return;
        }

        if (data.status === "SEM_DADOS" || data.status === "NAO_ENCONTRADO") {
            mostrarCadastro();
            return;
        }

        mostrarErro("Erro inesperado.");
    } catch (e) {
        mostrarErro("Erro ao conectar com o servidor.");
    }
}

function mostrarCadastro() {
    document.getElementById("app").innerHTML = `
        <h3>Pulseira não cadastrada</h3>
        <p>Este código ainda não possui dados.</p>
        <a href="https://tally.so/r/pbd5zy" class="btn btn-primary mt-2">Cadastrar agora</a>
    `;
}

function mostrarDados(dados) {
    document.getElementById("app").innerHTML = `
        <h2>${dados["Nome da criança"]}</h2>
        <p>Cadastro ativo</p>
    `;
}

function mostrarErro(msg) {
    document.getElementById("app").innerHTML = `
        <h3 class="text-danger">${msg}</h3>
    `;
}

carregar();
</script>
</body>
</html>
